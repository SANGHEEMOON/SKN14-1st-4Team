import requests
import pandas as pd
import os, glob

# SERVICE_KEY = f'COVqDxtrNsa1PEgImSCkU%2B9ncLCoNr4m%2Bh6kiSZX%2B8dTB5pAB9VgCV1y0B8OqZvYpiMjOBMHGId7NJlJPAALwA%3D%3D'
# key_decode = requests.utils.unquote(SERVICE_KEY) #무조건 디코딩된 키 사용

# API_URL = "http://apis.data.go.kr/B552584/EvCharger/getChargerInfo"
# def get_charger_info(zscode, num_of_rows=9999):
#     params = {
#         'serviceKey': key_decode,
#         'pageNo': '1',
#         'numOfRows': str(num_of_rows),
#         # 'zcode': str(zcode),
#         'zscode': str(zscode),
#         'dataType': 'JSON'
#     }
#     response = requests.get(API_URL, params=params)
#     data = response.json()
#     items = data.get('items', {}).get('item', [])
#     return pd.DataFrame(items)


zscode = {
    "종로구": 11110,
    "중구(서울)": 11140,
    "용산구": 11170,
    "성동구": 11200,
    "광진구": 11215,
    "동대문구": 11230,
    "중랑구": 11260,
    "성북구": 11290,
    "강북구": 11305,
    "도봉구": 11320,
    "노원구": 11350,
    "은평구": 11380,
    "서대문구": 11410,
    "마포구": 11440,
    "양천구": 11470,
    "강서구(서울)": 11500,
    "구로구": 11530,
    "금천구": 11545,
    "영등포구": 11560,
    "동작구": 11590,
    "관악구": 11620,
    "서초구": 11650,
    "강남구": 11680,
    "송파구": 11710,
    "강동구": 11740,
    "중구(부산)": 26110,
    "서구(부산)": 26140,
    "동구(부산)": 26170,
    "영도구": 26200,
    "부산진구": 26230,
    "동래구": 26260,
    "남구(부산)": 26290,
    "북구(부산)": 26320,
    "해운대구": 26350,
    "사하구": 26380,
    "금정구(부산)": 26410,
    "강서구(부산)": 26440,
    "연제구": 26470,
    "수영구": 26500,
    "사상구": 26530,
    "기장군": 26710,
    "중구(대구)": 27110,
    "동구(대구)": 27140,
    "서구(대구)": 27170,
    "남구(대구)": 27200,
    "북구(대구)": 27230,
    "수성구": 27260,
    "달서구": 27290,
    "달성군": 27710,
    "군위군(대구)": 27720,
    "중구(인천)": 28110,
    "동구(인천)": 28140,
    "미추홀구": 28177,
    "연수구": 28185,
    "남동구": 28200,
    "부평구": 28237,
    "계양구": 28245,
    "서구(인천)": 28260,
    "강화군": 28710,
    "옹진군": 28720,
    "동구(광주)": 29110,
    "서구(광주)": 29140,
    "남구(광주)": 29155,
    "북구(광주)": 29170,
    "광산구": 29200,
    "동구(대전)": 30110,
    "중구(대전)": 30140,
    "서구(대전)": 30170,
    "유성구": 30200,
    "대덕구": 30230,
    "중구(울산)": 31110,
    "남구(울산)": 31140,
    "동구(울산)": 31170,
    "북구(울산)": 31200,
    "울주군": 31710,
    "세종특별자치시": 36110,
    "수원시": 41110,
    "성남시": 41130,
    "의정부시": 41150,
    "안양시": 41170,
    "부천시": 41190,
    "광명시": 41210,
    "평택시": 41220,
    "동두천시": 41250,
    "안산시": 41270,
    "고양시": 41280,
    "과천시": 41290,
    "구리시": 41310,
    "남양주시": 41360,
    "오산시": 41370,
    "시흥시": 41390,
    "군포시": 41410,
    "의왕시": 41430,
    "하남시": 41450,
    "용인시": 41460,
    "파주시": 41480,
    "이천시": 41500,
    "안성시": 41550,
    "김포시": 41570,
    "화성시": 41590,
    "광주시(경기)": 41610,
    "양주시": 41630,
    "포천시": 41650,
    "여주시": 41670,
    "연천군": 41800,
    "가평군": 41820,
    "양평군": 41830,
    "청주시": 43110,
    "충주시": 43130,
    "제천시": 43150,
    "보은군": 43720,
    "옥천군": 43730,
    "영동군": 43740,
    "증평군": 43745,
    "진천군": 43750,
    "괴산군": 43760,
    "음성군": 43770,
    "단양군": 43800,
    "천안시": 44130,
    "공주시": 44150,
    "보령시": 44180,
    "아산시": 44200,
    "서산시": 44210,
    "논산시": 44230,
    "계룡시": 44250,
    "당진시": 44270,
    "금산군": 44710,
    "부여군": 44760,
    "서천군": 44770,
    "청양군": 44790,
    "홍성군": 44800,
    "예산군": 44810,
    "태안군": 44825,
    "목포시": 46110,
    "여수시": 46130,
    "순천시": 46150,
    "나주시": 46170,
    "광양시": 46230,
    "담양군": 46710,
    "곡성군": 46720,
    "구례군": 46730,
    "고흥군": 46770,
    "보성군": 46780,
    "화순군": 46790,
    "장흥군": 46800,
    "강진군": 46810,
    "해남군": 46820,
    "영암군": 46830,
    "무안군": 46840,
    "함평군": 46860,
    "영광군": 46870,
    "장성군": 46880,
    "완도군": 46890,
    "진도군": 46900,
    "신안군": 46910,
    "포항시": 47110,
    "경주시": 47130,
    "김천시": 47150,
    "안동시": 47170,
    "구미시": 47190,
    "영주시": 47210,
    "영천시": 47230,
    "상주시": 47250,
    "문경시": 47280,
    "경산시": 47290,
    "군위군(경북)": 47720,
    "의성군": 47730,
    "청송군": 47750,
    "영양군": 47760,
    "영덕군": 47770,
    "청도군": 47820,
    "고령군": 47830,
    "성주군": 47840,
    "칠곡군": 47850,
    "예천군": 47900,
    "봉화군": 47920,
    "울진군": 47930,
    "울릉군": 47940,
    "창원시": 48120,
    "진주시": 48170,
    "통영시": 48220,
    "사천시": 48240,
    "김해시": 48250,
    "밀양시": 48270,
    "거제시": 48310,
    "양산시": 48330,
    "의령군": 48720,
    "함안군": 48730,
    "창녕군": 48740,
    "고성군(경남)": 48820,
    "남해군": 48840,
    "하동군": 48850,
    "산청군": 48860,
    "함양군": 48870,
    "거창군": 48880,
    "합천군": 48890,
    "제주시": 50110,
    "서귀포시": 50130,
    "춘천시": 51110,
    "원주시": 51130,
    "강릉시": 51150,
    "동해시": 51170,
    "태백시": 51190,
    "속초시": 51210,
    "삼척시": 51230,
    "홍천군": 51720,
    "횡성군": 51730,
    "영월군": 51750,
    "평창군": 51760,
    "정선군": 51770,
    "철원군": 51780,
    "화천군": 51790,
    "양구군": 51800,
    "인제군": 51810,
    "고성군(강원)": 51820,
    "양양군": 51830,
    "전주시": 52110,
    "군산시": 52130,
    "익산시": 52140,
    "정읍시": 52180,
    "남원시": 52190,
    "김제시": 52210,
    "완주군": 52710,
    "진안군": 52720,
    "무주군": 52730,
    "장수군": 52740,
    "임실군": 52750,
    "순창군": 52770,
    "고창군": 52790,
    "부안군": 52800,
}
'''
# 여기가 각 전국 단위(지역상세코드)별로 csv파일 생성되는 부분. 총 230개, 위에 주석처리된 key랑 get_charger_info 함수 주석 풀어야됨
iter = len(zscode)
i = 0
# for city in zcode:
for city_ in zscode:
    i += 1
    df = get_charger_info(zscode[city_])
    file_name = f'{city_}_충전소_정보.csv'
    df.to_csv(file_name, index=False, encoding='utf-8-sig')
    print(f'{file_name} 생성 완료...... {i}/{iter}')
'''

''' 
# 여기가 위에서 만들어진 총 230개의 csv파일을 읽고 concat해서 하나의 csv 파일로 만드는 부분.
csv_files = glob.glob('*.csv')
df_list = []
for file in csv_files:
    df = pd.read_csv(file, encoding='utf-8-sig')
    df_list.append(df)

merged_df = pd.concat(df_list, ignore_index=True)
merged_df.to_csv('전체_충전소_정보.csv', index=False, encoding='utf-8-sig')
print('csv파일 취합 완료')
'''